<!DOCTYPE html>
<html>
<head>
  <title>Auth State Test</title>
  <style>
    body {
      font-family: Arial;
      padding: 20px;
      background: #1a1a1a;
      color: white;
    }
    .log {
      background: #2a2a2a;
      padding: 10px;
      margin: 10px 0;
      border-radius: 4px;
      border-left: 3px solid #cc785c;
    }
    .success { border-left-color: #4CAF50; }
    .error { border-left-color: #f44336; }
    button {
      padding: 10px 20px;
      margin: 5px;
      cursor: pointer;
      background: #cc785c;
      color: white;
      border: none;
      border-radius: 6px;
    }
    button:hover {
      background: #e08a6e;
    }
  </style>
</head>
<body>
  <h1>Authentication State Test</h1>

  <div>
    <button onclick="checkAuthState()">Check Auth State</button>
    <button onclick="checkElements()">Check UI Elements</button>
    <button onclick="forceShowProfile()">Force Show Profile</button>
  </div>

  <div id="log"></div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

  <script src="js/firebase-config.js"></script>

  <script>
    function log(message, type = 'info') {
      const logDiv = document.getElementById('log');
      const entry = document.createElement('div');
      entry.className = 'log ' + (type === 'success' ? 'success' : type === 'error' ? 'error' : '');
      entry.textContent = new Date().toLocaleTimeString() + ': ' + message;
      logDiv.insertBefore(entry, logDiv.firstChild);
      console.log(message);
    }

    log('Page loaded');

    // Wait for Firebase to initialize
    setTimeout(() => {
      if (typeof firebase !== 'undefined') {
        log('✓ Firebase is loaded', 'success');

        // Check auth instance
        const auth = firebase.auth();
        log('✓ Firebase auth initialized', 'success');

        // Check current user immediately
        const currentUser = auth.currentUser;
        if (currentUser) {
          log('✓ User is signed in: ' + currentUser.email, 'success');
          log('User display name: ' + (currentUser.displayName || 'Not set'));
          log('User UID: ' + currentUser.uid);
        } else {
          log('✗ No user currently signed in', 'error');
        }

        // Listen for auth state changes
        auth.onAuthStateChanged((user) => {
          if (user) {
            log('✓ Auth state changed - User signed in: ' + user.email, 'success');
          } else {
            log('✗ Auth state changed - No user signed in', 'error');
          }
        });
      } else {
        log('✗ Firebase is NOT loaded', 'error');
      }
    }, 1000);

    function checkAuthState() {
      if (typeof firebase !== 'undefined') {
        const auth = firebase.auth();
        const user = auth.currentUser;
        if (user) {
          log('Current user: ' + user.email, 'success');
          log('Display name: ' + (user.displayName || 'Not set'));
          log('Email verified: ' + user.emailVerified);
        } else {
          log('No user signed in', 'error');
        }
      } else {
        log('Firebase not available', 'error');
      }
    }

    function checkElements() {
      // This would work on the main page
      log('This function only works on the main index.html page');
      log('Open browser console on index.html and run:');
      log('  document.getElementById("authButton")');
      log('  document.getElementById("userProfile")');
    }

    function forceShowProfile() {
      log('This function only works on the main index.html page');
      log('Open browser console on index.html and run:');
      log('  document.getElementById("authButton").style.display = "none"');
      log('  document.getElementById("userProfile").style.display = "flex"');
      log('  document.getElementById("userInitialCircle").textContent = "AS"');
    }
  </script>
</body>
</html>
