<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-LSRR4KW715"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-LSRR4KW715');
  </script>

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NDhub - Year Selection</title>

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="assets/ShepTech logo.png">
  <link rel="apple-touch-icon" href="assets/ShepTech logo.png">

  <!-- Primary Meta Tags -->
  <meta name="title" content="NDhub - Medical Student SCP Cases">
  <meta name="description" content="Comprehensive collection of medical student practice cases for Year 3 and Year 4 covering Medicine, Surgery, Psychiatry, and Paediatrics.">

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://md3-scp.netlify.app/">
  <meta property="og:title" content="NDhub - Medical Student SCP Cases">
  <meta property="og:description" content="Comprehensive collection of medical student practice cases for Year 3 and Year 4.">
  <meta property="og:image" content="https://md3-scp.netlify.app/assets/ShepTech%20logo.png">

  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:url" content="https://md3-scp.netlify.app/">
  <meta property="twitter:title" content="NDhub - Medical Student SCP Cases">
  <meta property="twitter:description" content="Comprehensive collection of medical student practice cases.">

  <link rel="stylesheet" href="css/main.css?v=20251126-1">

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: Georgia, 'Times New Roman', serif;
      background: #fafafa;
      min-height: 100vh;
      height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
      overflow: hidden;
    }

    .year-selector-container {
      max-width: 1000px;
      width: 100%;
      text-align: center;
      display: flex;
      flex-direction: column;
      justify-content: center;
      max-height: 100vh;
    }

    .logo-section {
      margin-bottom: 25px;
    }

    .main-logo {
      width: 80px;
      height: 80px;
      margin-bottom: 15px;
      filter: drop-shadow(0 10px 30px rgba(0, 0, 0, 0.2));
      animation: spinOnce 1s ease-out;
    }

    .site-title {
      font-size: 2.5rem;
      font-weight: 400;
      color: #2c3e50;
      margin-bottom: 8px;
      letter-spacing: 2px;
    }

    .site-subtitle {
      font-size: 1rem;
      color: #5a6c7d;
      font-weight: 300;
    }

    .auth-section {
      margin-bottom: 25px;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 70px;
      position: relative;
    }

    #signedOutView,
    #signedInView {
      transition: opacity 0.3s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    #signedOutView.hidden,
    #signedInView.hidden {
      display: none;
    }

    .auth-button {
      background: #D97757;
      color: white;
      border: none;
      padding: 10px 30px;
      font-size: 0.95rem;
      font-family: Georgia, 'Times New Roman', serif;
      border-radius: 50px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 10px 30px rgba(217, 119, 87, 0.3);
    }

    .auth-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 15px 40px rgba(217, 119, 87, 0.4);
      background: #c66847;
    }

    .user-welcome {
      font-size: 1.3rem;
      color: #2c3e50;
      margin-bottom: 10px;
    }

    .user-email {
      color: #5a6c7d;
      font-size: 0.95rem;
      margin-bottom: 15px;
    }

    .signout-btn {
      background: transparent;
      color: #D97757;
      border: 2px solid #D97757;
      padding: 8px 25px;
      font-size: 0.9rem;
      border-radius: 25px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: Georgia, 'Times New Roman', serif;
    }

    .signout-btn:hover {
      background: #D97757;
      color: white;
    }

    .year-selection-title {
      font-size: 1.5rem;
      color: #2c3e50;
      margin-bottom: 20px;
      font-weight: 400;
    }

    .year-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 25px;
      margin-bottom: 20px;
    }

    .year-card {
      background: white;
      border-radius: 20px;
      padding: 30px 25px;
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
      position: relative;
      overflow: hidden;
      text-decoration: none;
      color: inherit;
    }

    .year-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 5px;
      background: #D97757;
      transform: scaleX(0);
      transition: transform 0.4s ease;
    }

    .year-card:hover::before {
      transform: scaleX(1);
    }

    .year-card:hover {
      transform: translateY(-10px);
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
    }

    .year-number {
      font-size: 3.5rem;
      font-weight: 300;
      color: #D97757;
      margin-bottom: 8px;
      transition: all 0.3s ease;
    }

    .year-card:hover .year-number {
      transform: scale(1.1);
      color: #c66847;
    }

    .year-title {
      font-size: 1.4rem;
      color: #2c3e50;
      margin-bottom: 12px;
      font-weight: 400;
    }

    .year-description {
      color: #5a6c7d;
      font-size: 0.9rem;
      line-height: 1.5;
      margin-bottom: 15px;
    }

    .year-stats {
      display: flex;
      justify-content: space-around;
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid #e8ecef;
    }

    .stat {
      text-align: center;
    }

    .stat-number {
      font-size: 1.2rem;
      font-weight: 600;
      color: #D97757;
    }

    .stat-label {
      font-size: 0.75rem;
      color: #5a6c7d;
      margin-top: 3px;
    }

    .footer {
      margin-top: 20px;
      color: #5a6c7d;
      font-size: 0.85rem;
      animation: fadeIn 1.5s ease-out 1s both;
    }

    @keyframes fadeInDown {
      from {
        opacity: 0;
        transform: translateY(-30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }

    @keyframes spinOnce {
      0% {
        transform: rotate(0deg);
      }
      100% {
        transform: rotate(360deg);
      }
    }

    .locked-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(255, 255, 255, 0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 20px;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .year-card.locked {
      cursor: not-allowed;
      opacity: 0.7;
    }

    .year-card.locked:hover {
      transform: none;
    }

    .year-card.locked .locked-overlay {
      opacity: 1;
    }

    .lock-icon {
      font-size: 3rem;
      color: #95a5a6;
    }

    @media (max-width: 768px) {
      .site-title {
        font-size: 2.2rem;
      }

      .site-subtitle {
        font-size: 1rem;
      }

      .main-logo {
        width: 90px;
        height: 90px;
      }

      .logo-section {
        margin-bottom: 35px;
      }

      .year-number {
        font-size: 3.5rem;
      }

      .year-title {
        font-size: 1.5rem;
      }

      .year-cards {
        gap: 25px;
        grid-template-columns: 1fr;
      }

      .year-card {
        padding: 40px 25px;
      }

      .auth-button {
        padding: 12px 30px;
        font-size: 1rem;
      }

      .year-selection-title {
        font-size: 1.6rem;
        margin-bottom: 30px;
      }

      .footer {
        margin-top: 40px;
        font-size: 0.85rem;
      }
    }

    @media (max-width: 480px) {
      body {
        padding: 15px;
      }

      .site-title {
        font-size: 1.8rem;
        letter-spacing: 1px;
      }

      .site-subtitle {
        font-size: 0.9rem;
      }

      .main-logo {
        width: 70px;
        height: 70px;
      }

      .logo-section {
        margin-bottom: 25px;
      }

      .year-number {
        font-size: 3rem;
      }

      .year-title {
        font-size: 1.3rem;
      }

      .year-card {
        padding: 30px 20px;
      }

      .stat-number {
        font-size: 1.3rem;
      }

      .stat-label {
        font-size: 0.75rem;
      }

      .auth-button {
        padding: 10px 25px;
        font-size: 0.95rem;
      }

      .year-selection-title {
        font-size: 1.4rem;
        margin-bottom: 25px;
      }

      .year-description {
        font-size: 0.9rem;
      }

      .footer {
        margin-top: 30px;
        font-size: 0.8rem;
      }
    }

    /* Auth Modal Styles - Use smooth animation */
    .auth-modal {
      transition: opacity 0.3s ease;
      opacity: 0;
    }

    .auth-modal.show {
      opacity: 1;
    }

    .auth-modal-content {
      transform: translateY(20px);
      opacity: 0;
      transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.3s ease;
    }

    .auth-modal.show .auth-modal-content {
      transform: translate(-50%, -50%);
      opacity: 1;
    }

    .auth-tabs {
      display: flex;
      gap: 0;
      border-bottom: 2px solid #e8ecef;
      margin-bottom: 25px;
    }

    .auth-tab {
      flex: 1;
      padding: 15px 20px;
      background: none;
      border: none;
      border-bottom: 3px solid transparent;
      color: #5a6c7d;
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: Georgia, 'Times New Roman', serif;
      margin-bottom: -2px;
    }

    .auth-tab:hover {
      color: #D97757;
    }

    .auth-tab.active {
      color: #D97757;
      border-bottom-color: #D97757;
      font-weight: 600;
    }

    .auth-form {
      margin-top: 0;
    }

    .auth-form input {
      width: 100%;
      padding: 15px;
      margin: 10px 0;
      border: 2px solid #e8ecef;
      border-radius: 10px;
      font-size: 1rem;
      font-family: Georgia, 'Times New Roman', serif;
      transition: border-color 0.3s ease;
    }

    .auth-form input:focus {
      outline: none;
      border-color: #D97757;
    }

    .auth-submit-button {
      width: 100%;
      background: #D97757;
      color: white;
      border: none;
      padding: 15px;
      font-size: 1.1rem;
      border-radius: 10px;
      cursor: pointer;
      margin-top: 20px;
      font-family: Georgia, 'Times New Roman', serif;
      transition: all 0.3s ease;
    }

    .auth-submit-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(217, 119, 87, 0.3);
      background: #c66847;
    }

    .auth-link {
      text-align: center;
      margin-top: 20px;
      color: #D97757;
      cursor: pointer;
    }

    .auth-link a {
      color: #D97757;
      text-decoration: none;
    }

    .auth-link a:hover {
      text-decoration: underline;
    }

    .auth-divider {
      text-align: center;
      margin: 20px 0;
      position: relative;
    }

    .auth-divider::before {
      content: '';
      position: absolute;
      left: 0;
      top: 50%;
      width: 100%;
      height: 1px;
      background: #e8ecef;
    }

    .auth-divider span {
      background: white;
      padding: 0 15px;
      position: relative;
      color: #5a6c7d;
    }
  </style>
</head>
<body>

  <div class="year-selector-container">
    <div class="logo-section">
      <svg class="main-logo" width="120" height="120" viewBox="0 0 120 120" fill="none" xmlns="http://www.w3.org/2000/svg">
        <g class="logo-animation-group">
          <circle cx="60" cy="60" r="18" fill="#D97757"/>
          <path d="M60 12 Q60 36, 60 36" stroke="#D97757" stroke-width="12" stroke-linecap="round"/>
          <path d="M108 60 Q84 60, 84 60" stroke="#D97757" stroke-width="12" stroke-linecap="round"/>
          <path d="M60 108 Q60 84, 60 84" stroke="#D97757" stroke-width="12" stroke-linecap="round"/>
          <path d="M12 60 Q36 60, 36 60" stroke="#D97757" stroke-width="12" stroke-linecap="round"/>
          <path d="M87 33 Q72 48, 72 48" stroke="#D97757" stroke-width="10.5" stroke-linecap="round"/>
          <path d="M87 87 Q72 72, 72 72" stroke="#D97757" stroke-width="10.5" stroke-linecap="round"/>
          <path d="M33 87 Q48 72, 48 72" stroke="#D97757" stroke-width="10.5" stroke-linecap="round"/>
          <path d="M33 33 Q48 48, 48 48" stroke="#D97757" stroke-width="10.5" stroke-linecap="round"/>
        </g>
      </svg>
      <h1 class="site-title">NDhub</h1>
    </div>

    <div class="auth-section" id="authSection">
      <div id="signedOutView" class="hidden">
        <button class="auth-button" id="authButton">Sign In or Create Account</button>
      </div>
      <div id="signedInView" class="hidden">
        <p class="user-welcome" id="userWelcome">Welcome back!</p>
        <button class="signout-btn" id="signoutButton">Sign Out</button>
      </div>
    </div>

    <div id="yearSelection">
      <div class="year-cards">
        <a href="year3/index.html" class="year-card">
          <div class="year-number">3</div>
          <h3 class="year-title">Year 3</h3>
          <ul class="year-description" style="list-style: none; padding: 0; text-align: left; margin: 0 auto; max-width: 250px;">
            <li style="margin-bottom: 8px;">✓ All SCPs</li>
            <li style="margin-bottom: 8px;">✓ All SCP Question Answers</li>
            <li style="margin-bottom: 8px;">✓ 5 Past Exams</li>
          </ul>
          <div class="year-stats">
            <div class="stat">
              <div class="stat-number">177</div>
              <div class="stat-label">Cases</div>
            </div>
            <div class="stat">
              <div class="stat-number">5</div>
              <div class="stat-label">Past Exams</div>
            </div>
          </div>
        </a>

        <a href="year4/index.html" class="year-card">
          <div class="year-number">4</div>
          <h3 class="year-title">Year 4</h3>
          <ul class="year-description" style="list-style: none; padding: 0; text-align: left; margin: 0 auto; max-width: 250px;">
            <li style="margin-bottom: 8px;">✓ All SCPs</li>
            <li style="margin-bottom: 8px;">✓ All SCP Question Answers</li>
            <li style="margin-bottom: 8px;">✓ 0 Past Exams</li>
          </ul>
          <div class="year-stats">
            <div class="stat">
              <div class="stat-number">Coming</div>
              <div class="stat-label">Soon</div>
            </div>
            <div class="stat">
              <div class="stat-number">-</div>
              <div class="stat-label">Past Exams</div>
            </div>
          </div>
        </a>
      </div>
    </div>

    <div class="footer">
      Powered by Sheptech ©
    </div>
  </div>

  <!-- Authentication Modal -->
  <div id="authModal" class="auth-modal">
    <div class="auth-modal-content">
      <span class="auth-modal-close" id="authModalClose">&times;</span>

      <!-- Value Proposition -->
      <h2 style="text-align: center; font-size: 2rem; color: #2c3e50; margin-bottom: 10px; font-weight: 600;">Free for now!</h2>

      <!-- Tab Navigation -->
      <div class="auth-tabs" id="authTabs">
        <button class="auth-tab" id="signUpTab" data-tab="signup">Create Account</button>
        <button class="auth-tab" id="signInTab" data-tab="signin">Sign In</button>
      </div>

      <div id="authError" style="display: none; color: #e74c3c; margin: 15px 0; padding: 10px; background: #fadbd8; border-radius: 5px;"></div>

      <!-- Sign Up Form (Default) -->
      <form id="signUpForm" class="auth-form">
        <p style="margin-bottom: 20px; color: #5a6c7d; font-size: 0.95rem; text-align: center; line-height: 1.8;">
          <span style="color: #27ae60; font-weight: 600;">✓</span> All SCPs<br>
          <span style="color: #27ae60; font-weight: 600;">✓</span> All Past Exams<br>
          <span style="color: #27ae60; font-weight: 600;">✓</span> All Past OSCEs<br>
          <span style="color: #27ae60; font-weight: 600;">✓</span> Progress Tracking
        </p>
        <input type="text" id="signUpName" placeholder="Full Name" required>
        <input type="email" id="signUpEmail" placeholder="Email" required>
        <input type="password" id="signUpPassword" placeholder="Password (min 6 characters)" required>
        <button type="submit" class="auth-submit-button">Create Account</button>
      </form>

      <!-- Sign In Form -->
      <form id="signInForm" class="auth-form" style="display: none;">
        <p style="margin-bottom: 20px; color: #5a6c7d; font-size: 0.95rem;">Welcome back! Sign in to access your saved progress</p>
        <input type="email" id="signInEmail" placeholder="Email" required>
        <input type="password" id="signInPassword" placeholder="Password" required>
        <button type="submit" class="auth-submit-button">Sign In</button>
        <p class="auth-link" id="showForgotPassword" style="margin-top: 15px;">Forgot password?</p>
      </form>

      <!-- Forgot Password Form -->
      <form id="forgotPasswordForm" class="auth-form" style="display: none;">
        <p style="margin-bottom: 15px; color: #5a6c7d;">Enter your email to receive a password reset link</p>
        <input type="email" id="forgotPasswordEmail" placeholder="Email" required>
        <button type="submit" class="auth-submit-button">Send Reset Link</button>
        <p class="auth-link" id="backToSignIn" style="margin-top: 15px;">Back to sign in</p>
      </form>
    </div>
  </div>

  <!-- Load Firebase Config and Auth -->
  <script src="js/firebase-config.js"></script>
  <script src="js/core/EventBus.js"></script>
  <script src="js/core/FirebaseService.js"></script>
  <script src="js/auth.js"></script>

  <script>
    // Auth state observer
    firebase.auth().onAuthStateChanged((user) => {
      const signedOutView = document.getElementById('signedOutView');
      const signedInView = document.getElementById('signedInView');
      const userWelcome = document.getElementById('userWelcome');

      if (user) {
        // User is signed in
        signedOutView.classList.add('hidden');
        signedInView.classList.remove('hidden');

        // Get user's display name or email
        const displayName = user.displayName || user.email.split('@')[0];
        userWelcome.textContent = `Welcome back, ${displayName}!`;
      } else {
        // User is signed out - still show year selection
        signedOutView.classList.remove('hidden');
        signedInView.classList.add('hidden');
      }
    });

    // Auth modal controls
    const authModal = document.getElementById('authModal');
    const authButton = document.getElementById('authButton');
    const authModalClose = document.getElementById('authModalClose');
    const signInForm = document.getElementById('signInForm');
    const signUpForm = document.getElementById('signUpForm');
    const forgotPasswordForm = document.getElementById('forgotPasswordForm');
    const authError = document.getElementById('authError');

    // Show modal with smooth animation
    authButton.addEventListener('click', () => {
      authModal.style.display = 'block';
      setTimeout(() => {
        authModal.classList.add('show');
      }, 10);
    });

    // Close modal with smooth animation
    const closeModal = () => {
      authModal.classList.remove('show');
      setTimeout(() => {
        authModal.style.display = 'none';
      }, 300);
    };

    authModalClose.addEventListener('click', closeModal);

    // Close modal on outside click
    window.addEventListener('click', (e) => {
      if (e.target === authModal) {
        closeModal();
      }
    });

    // Tab switching
    const signUpTab = document.getElementById('signUpTab');
    const signInTab = document.getElementById('signInTab');
    const authTabs = document.getElementById('authTabs');

    function switchToSignUp() {
      signInForm.style.display = 'none';
      signUpForm.style.display = 'block';
      forgotPasswordForm.style.display = 'none';
      authTabs.style.display = 'flex';
      signUpTab.classList.add('active');
      signInTab.classList.remove('active');
      authError.style.display = 'none';
    }

    function switchToSignIn() {
      signInForm.style.display = 'block';
      signUpForm.style.display = 'none';
      forgotPasswordForm.style.display = 'none';
      authTabs.style.display = 'flex';
      signInTab.classList.add('active');
      signUpTab.classList.remove('active');
      authError.style.display = 'none';
    }

    signUpTab.addEventListener('click', switchToSignUp);
    signInTab.addEventListener('click', switchToSignIn);

    // Initialize with Sign Up tab active
    switchToSignUp();

    document.getElementById('showForgotPassword').addEventListener('click', (e) => {
      e.preventDefault();
      signInForm.style.display = 'none';
      signUpForm.style.display = 'none';
      forgotPasswordForm.style.display = 'block';
      authTabs.style.display = 'none';
      authError.style.display = 'none';
    });

    document.getElementById('backToSignIn').addEventListener('click', (e) => {
      e.preventDefault();
      switchToSignIn();
    });

    // Sign In
    signInForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = document.getElementById('signInEmail').value;
      const password = document.getElementById('signInPassword').value;

      try {
        await firebase.auth().signInWithEmailAndPassword(email, password);
        closeModal();
        authError.style.display = 'none';
      } catch (error) {
        authError.textContent = error.message;
        authError.style.display = 'block';
      }
    });

    // Sign Up
    signUpForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = document.getElementById('signUpEmail').value;
      const name = document.getElementById('signUpName').value;
      const password = document.getElementById('signUpPassword').value;

      try {
        const userCredential = await firebase.auth().createUserWithEmailAndPassword(email, password);
        await userCredential.user.updateProfile({ displayName: name });
        closeModal();
        authError.style.display = 'none';
      } catch (error) {
        authError.textContent = error.message;
        authError.style.display = 'block';
      }
    });

    // Forgot Password
    forgotPasswordForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = document.getElementById('forgotPasswordEmail').value;

      try {
        await firebase.auth().sendPasswordResetEmail(email);
        authError.style.display = 'block';
        authError.style.background = '#d4edda';
        authError.style.color = '#155724';
        authError.textContent = 'Password reset email sent! Check your inbox.';
        setTimeout(() => {
          authError.style.display = 'none';
          document.getElementById('backToSignIn').click();
        }, 3000);
      } catch (error) {
        authError.style.display = 'block';
        authError.style.background = '#fadbd8';
        authError.style.color = '#e74c3c';
        authError.textContent = error.message;
      }
    });

    // Sign Out
    document.getElementById('signoutButton').addEventListener('click', async () => {
      try {
        await firebase.auth().signOut();
      } catch (error) {
        console.error('Error signing out:', error);
      }
    });
  </script>

</body>
</html>
